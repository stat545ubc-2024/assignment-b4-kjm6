---
title: "assignment-b4"
output: html_document
date: "2024-12-03"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(stringr)
library(purrr)
library(janeaustenr)
library(tidytext)
library(tidyverse)
library(wordcloud)
library(datateachr)
```

## Exercise 1

### Task: Develop a plot of the most commonly used words in the Jane Austen novel "Pride and Prejudice"

Step 1: Tidying character data

```{r}
prideprejudicewords <- prideprejudice %>% 
  paste(collapse = " ") %>% # paste to string
  str_remove_all("\\d") %>% # remove numbers 
  str_remove_all("[[:punct:]]") %>% # remove punctuation
  str_squish() %>%  # remove blank spaces
  str_split("\\s+") %>% # split string into individual words
  unlist() %>% #unlisting the string
  str_to_lower() %>% # convert to lowercase
  .[!. %in% stop_words$word] # remove stop words
```

Step 2: Plotting the most common words as a wordle

```{r}
word_freq <- table(prideprejudicewords) %>% # counting occurence of each word
  sort(decreasing = TRUE)
wordcloud(names(word_freq), freq = word_freq, min.freq = 50, scale = c(3, 1)) # plotting wordcloud based on frequency
```


## Exercise 2

### Task: Make a function that converts words into your own version of pig latin

Step 1: Write the code to translate words to pig latin

```{r}
kjm_pig_latin <- function(.) {
  consonants <- c("b", "c", "d", "f", "g", "h", "j", "k", "l", "m", "n", "p", "q", "r", "s", "t", "v", "w", "x", "y", "z")
  
  # Function to check if a character is a consonant
  is_consonant <- function(char) {
    return(str_to_lower(char) %in% consonants)
  }
  
  # Check for the presence and length of a consonant cluster at the front
  starts_with_consonant_cluster <- function(.) {
    cluster_end <- 1
    while (cluster_end <= str_length(.) && is_consonant(str_sub(., cluster_end, cluster_end))) {
      cluster_end <- cluster_end + 1
    }
    return(cluster_end - 1)
  }
  
  # If the word starts with a consonant cluster, move the consonant cluster to the end and append "ak"
  consonant_cluster_len <- starts_with_consonant_cluster(.)
  if (consonant_cluster_len > 0) {
    consonant_cluster <- str_sub(., 1, consonant_cluster_len)
    remaining_word <- str_sub(., consonant_cluster_len + 1, str_length(.))
    return(str_c(remaining_word, consonant_cluster, "ak"))
  } else {
    # If the word starts with a vowel cluster, leave the word structure and append "ak" to the end
    return(str_c(., "ak"))
  }
}

```

Step 2: Test the code on a set of words

```{r}
# Set the dictionary of words to translate
dictionary <- c("alpha", "bravo", "charlie", "delta", "echo", "foxtrot", "golf", "hotel", "india", "juliett", "kilo", "lima", "mike", "november", "oscar", "papa", "quebec", "romeo", "sierra", "tango", "uniform", "victor", "whiskey", "xray", "yankee", "yulu")

# Test the pig latin on the dictionary of words above
print(purrr::map_chr(dictionary, kjm_pig_latin))

```


## Exercise 3 

### Task: Evaluate a model that is fit seperately for each group in some dataset

Step 1: Make a column of model objects

```{r}
common_trees <- vancouver_trees %>%
  select(tree_id, genus_name, diameter, height_range_id) %>% #selecting columns that will be used
  group_by(genus_name) %>% #grouping by genus for count
  mutate(genus_count = n()) %>% #counting the number of trees in each genus
  filter(genus_count >= 50) %>%  #removing any trees with a genus count less than 50
  nest() %>%  #nesting initial data
  mutate(model = map(data, ~ lm(diameter ~ height_range_id, data = .))) #mapping linear regression model of diameter and height
```

Step 2: Evaluate the models for R-squared, coefficient, residual, and fitted values and print the intermediate tibble

```{r}
model_evaluation <- common_trees %>%
  mutate(r_squared = map(model, ~ summary(.x)$r.squared), #adding r-squared column
    coefficient = map(model, ~ coef(.x)[1]), #adding coefficient column
    residual = map(model, ~ residuals(.x)), #adding residual column
    fitted_value = map(model, ~ fitted(.x))) #adding fitted value column
```

Step 3: Print the nested intermediate tibble

```{r}
model_evaluation
```

Step 4: Unnest the calculations and print the final tibble

```{r}
final_tbl <- model_evaluation %>% 
  unnest(cols = c(data, r_squared, coefficient, residual, fitted_value)) %>% #unnesting columns
  arrange(r_squared) %>%  #sorting in order of ascended r-squared
  select(genus_name, r_squared, coefficient, residual, fitted_value)


glimpse(final_tbl)
```

Step 5: Produce a plot of the results

```{r}
plot_data <- final_tbl %>%
  group_by(genus_name) %>%
  summarise(avg_r_squared = mean(r_squared, na.rm = TRUE)) %>%
  mutate(genus_name = reorder(genus_name, avg_r_squared, FUN = max))

ggplot(plot_data, aes(x = genus_name, y = avg_r_squared)) +
  geom_bar(stat = "identity") +
  theme_minimal() +
  labs(title = "Most Common Trees in the City of Vancouver", subtitle = "Correlation between tree height and diameter", x = "Tree Genus", y = "R-squared Correlation") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 6))


```
